<%- include('../cabecalhokaban'); %>
<% if(id.length > 0) { %>
    <% for(var i = 0; i < id.length; i++) {%>
                 <table class="table table-striped"  style="width: 100%;" id="mytable">
                    <caption style="font-size: 25px; text-align: center; ">Kaban Pacientes Planalto</caption>
                    <input name="usuario" type="hidden" value="<%=id[i].id_usuario %>">
                        <thead>
                            <tr>
                                <th>SusFacil</th>
                                <th>Prontuario</th>
                                <th>Nome</th>
                                <th>Data de Nascimento</th>
                                <th>Idade</th>
                                <th>Data Admissão</th>
                                <th>Dias Internados</th>
                                <th>Setor</th>
                                <th>ECF</th>
                                <th>Paliativo</th>
                                <th>Diagnóstico</th>
                                <th>Especialidade</th>
                                <th>Banho</th>
                                <th>Mobilidade</th>
                                <th>Observação</th>
                                <th>Pendencias</th>
                                
                            </tr>
                            </thead>
                            <tbody>    
                                <% if(paciente.length > 0) { %>
                                    <% for(var j = 0; j < paciente.length; j++) {%>
                                        
                                <tr>                                  
                                    <td><%=paciente[j].susfacil %></td>
                                    <th><%=paciente[j].prt %></th>
                                    <td><%=paciente[j].nome %></td>
                                    <td><%=paciente[j].datanascimento %></td>
                                    <td></td>
                                    <td><%=paciente[j].dataentrada %></td>
                                    <td></td>
                                    <td><%=paciente[j].setor %></td>
                                    <td><%=paciente[j].ECF %></td>
                                    <td><%=paciente[j].paliativo %></td>
                                    <td><%=paciente[j].diagnostico %></td>
                                    <td><%=paciente[j].especialidade %></td>
                                    <td><%=paciente[j].banho %></td>
                                    <td><%=paciente[j].mobilidade %></td>
                                    <td><%=paciente[j].observacao %></td>
                                    <td ><%=paciente[j].pendencias %></td>
                            </tr>
                            <% } %>	
                            <% } %>
                        </tbody>
                </table>
        <% } %>	
        <% } %>
        <br>
					<br>
					<br>
    </div>
    

<!-- Importando o jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.2/js/dataTables.select.min.js" ></script>
<script src="/js/buttons.print.min.js"></script>
<script src="/js/dataTables.buttons.js"></script>
<!-- Importando o js do bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
     $(document).ready(function() {
var groupColumn = 7;
$('#mytable').DataTable( { 
dom: 'Bfrtip',
"scrollX": true,
rowGroup: {
        dataSrc: 'groupColumn'
    },
"columnDefs": [
            { "visible": false, "targets": groupColumn },
            {"className": "dt-center", "targets": "_all"},
           
        ],
        rowGroup: {
            dataSrc: groupColumn,
        },
        "order": [[ groupColumn, 'asc' ]],
        pageLength: 50,
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            var last=null;
 
            api.column(groupColumn, {page:'current'} ).data().each( function ( group, i ) {
                if ( last !== group ) {
                    $(rows).eq( i ).before(
                        '<tr class="group" ><td colspan="18" >'+group+'</td></tr>'
                    );
 
                    last = group;
                }
            } );
        },
        buttons: [       
            {
                "extend": "copyHtml5",
                "text": "COPIAR",
                orientation: 'landscape',
                pageSize: 'LEGAL',
               
            },          
            {
                "extend": "pdf",
                "text": "PDF",
                orientation: 'landscape',
                pageSize: 'LEGAL',
                alignment: "center",
                customize: function(doc) {
                    //pageMargins [left, top, right, bottom] 
                    doc.pageMargins = [ 20, 20, 150, 20 ];
                },
                exportOptions: {
                    grouped_array_index: [groupColumn],
                    columns: ':visible'
                },
            },
            {
                "extend": "excelHtml5",
                "text": "EXCEL",
                exportOptions: {
                    grouped_array_index: [groupColumn],
                    columns: ':visible'
                },
                customize: function( xlsx ) {
                var sheet = xlsx.xl.worksheets['sheet1.xml'];
                $('c', sheet).attr( 's', '51' );

            },
            orientation: 'landscape',
                pageSize: 'LEGAL'
            },
            {
                "extend": "print",
                "text": "IMPRIMIR", 
                exportOptions: {
                    grouped_array_index: [groupColumn],
                    columns: ':visible'
                },
                customize: function ( win ) {
                    $(win.document.body).css('text-align','center');
                    $(win.document.body).find('h1').css('text-align','center');
                    $(win.document.body).find('table').addClass('dt-center').css('text-align','center');
                },
                orientation: 'landscape',
                pageSize: 'A4'
            }
            
        ],language: {
            buttons: {
                copyTitle: 'Copiado para área de transferência',
                copyKeys: 'Appuyez sur <i>ctrl</i> ou <i>\u2318</i> + <i>C</i> pour copier les données du tableau à votre presse-papiers. <br><br>Pour annuler, cliquez sur ce message ou appuyez sur Echap.',
                copySuccess: {
                    _: '%d linhas copiadas',
                    1: '1 linha copiada'
                }
            },
            "paginate": {
                "previous": "Anterior",
                "next": "Próximo"
            },
            "search": "Pesquisar:"
        },
        select: true
    } );
} );


$('#mytable tbody tr').each(function(i){
            tr=$(this);
            valor=tr.children('td:eq(4)').html();
            idade=tr.children('td:eq(2)').html();
            var date2 = new Date(valor);
            const now = new Date(); // Data de hoje
            const diff = Math.abs(now.getTime() - date2.getTime()); // Subtrai uma data pela outra
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24)); // Divide o total pelo total de milisegundos correspondentes a 1 dia. (1000 milisegundos = 1 segundo).

            // Mostra a diferença em dias
            tr.children('td:eq(5)').text(days);
            tr.children('td:eq(3)').text(calcularIdade(idade));
});

function calcularIdade(aniversario) {
    var ano_atual = new Date().getFullYear();
var data_aniversario = new Date(aniversario).getFullYear();;
// var ano_informado = data_aniversario.split('/')[2];
return (ano_atual - data_aniversario);
   
}

    function pad(s){
            return (s<10) ? '0' + s :s;
        }
    function novaHora(){
        
        var date = new Date();
        document.getElementById('data').value = date.getDate() + "/" + (date.getMonth()+1) + "/" + date.getFullYear();
    }
    novaHora();
    
    
    function setaDadosModal(valor) {
        document.getElementById('campo').value = valor;
    }
    
    function setaDadosModal2(valor) {
        document.getElementById('campo2').value = valor;
    }
    $("#baixaselect").on('change', function(e){
        var baixa = $(this).val();
        document.getElementById('baixa').value = baixa;
    });
    
        
    </script>