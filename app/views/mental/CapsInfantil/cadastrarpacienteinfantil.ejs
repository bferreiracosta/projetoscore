<%- include('../cabecalhomental'); %>



        <% if(id.length > 0) { %>
            <% for(var i = 0; i < id.length; i++) {%>
       
                <h2>Pacientes</h2>
				<input id="usuario" name="usuario" type="hidden" value="<%=id[i].id_usuario %>">
                <table class="table table-striped" style="width: 100%;" id="mytable">
					<input id="usuario" name="usuario" type="hidden" value="<%=id[i].id_usuario %>">
					
                    <thead>
                        <tr>
                            <th hidden>id</th>
                            <th>Prontuario</th>
                            <th>Nome</th>
                            <th>Idade</th>
                            <th>Diagnóstico</th>
                            <th>Unidade de Referência</th>
                            <th hidden>Prioridade</th>
                            <th>Tratamento</th>
                            <th>Risco</th>
                            <th>Comportamento</th>
                            <th>Exposicao</th>
                            <th>Autonegligencia</th>
                            <th>Dependencia</th>
                            <th>Terapeutico</th>
                            <th>Social</th>   
                            <th></th>  
                            <th>Data Atualização</th>
                            <th>Hora Atualização</th>
                            <th></th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>    
                            <% if(mental.length > 0) { %>
                                <% for(var j = 0; j < mental.length; j++) {%>		
                            <tr>
                                <td hidden><label hidden for="">Id: </label><%=mental[j].id_paciente %></td>
                                <th><label hidden for="">/Prontuario: </label><%=mental[j].prt %></th>
                                <td><label hidden for="">/Nome: </label><%=mental[j].paciente %></td>
                                <td><label hidden for="">/Idade: </label><%=mental[j].idade %></td>
                                <td><label hidden for="">/Diagnostico: </label><%=mental[j].diagnostico %></td>
                                <td><label hidden for="">/Referência: </label><%=mental[j].referencia %></td>
                                <td hidden><label hidden for=""></label>/Prioridade: <%=mental[j].soma %></td>
                                <td><label hidden for="">/Tratamento: </label><%=mental[j].tratamento %></td>
                                <td><label hidden for="">/Risco: </label><%=mental[j].risco %></td>
                                <td><label hidden for="">/Comportamento: </label><%=mental[j].comportamento %></td>
                                <td><label hidden for="">/Exposicao: </label><%=mental[j].exposicao %></td>
                                <td><label hidden for="">/Autonegligencia: </label><%=mental[j].autonegligencia %></td>
                                <td><label hidden for="">/Dependencia: </label><%=mental[j].dependencia %></td>
                                <td><label hidden for="">/Terapeutico: </label><%=mental[j].terapeutico %></td>
                                <td><label hidden for="">/Social: </label><%=mental[j].social %></td>
                                <td><label hidden for="">/Data Atualização: </label></td>
                                <td><%=mental[j].dataatu %></td>
                                <td><label hidden for="">/Hora Atualização: </label><%=mental[j].hora %></td>
                            <td>
                                <a href="editpacienteinfantil/<%=id[i].id_usuario %>/?id=<%=mental[j].id_paciente %> %>" class="btn btn-sm btn-info edit">Edit</a>
                            </td>
                            <td>
                                <a href="" onclick="setaDadosModal('<%=mental[j].id_paciente %>'), setaDadosModal2('<%=id[i].id_usuario %>')" class="btn btn-sm btn-danger delete"  data-toggle="modal" data-target="#BaixaModal">Saida</a>
                            </td>
						</tr>
						<% } %>	
						<% } %>
                    </tbody>
				</table>
                <br>
                <br>
                <br>
         <!-- Delete Product Modal-->
         <form id="add-row-form" action="/baixahospitalidade" method="POST">
            <div class="modal fade" id="BaixaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="myModalLabel">Baixa Paciente</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <label for="motivo" id="label">Motivo da Saida</label>
                            <select  class="form-control" id="negativoselect" name="negativoselect">
                                <option value=""></option>
                                <option value="Encaminhado Urgência">Encaminhado Urgência</option>
                                <option value="Mudança Projeto Terapêutico">Mudança Projeto Terapêutico</option>
                                <option value="Recusa Tratamento">Recusa Tratamento</option>
                            </select>
                            <input type="hidden" name="campo" id="campo">
                            <input type="hidden" name="campo2" id="campo2">
                            <input type="hidden" name="profissional" id="profissional" value="<%=id[i].profissional %>">
                            <input type="hidden" name="negativo" id="negativo">
                          </div>
                          <input  type="hidden" name="covid" id="covid">
                          <input  type="hidden" id="data" name="data"  class="form-control">
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                            <button type="submit" class="btn btn-success">Destino</button>
                        </div>
                    </div>
                </div>
            </div>
           <% } %>	
            <% } %>
        </div>
<!-- Importando o jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pnotify/3.0.0/pnotify.min.js"></script>
<script src="https://colorlib.com/polygon/vendors/jquery/dist/jquery.min.js"></script>
<script src="https://colorlib.com/polygon/vendors/pnotify/dist/pnotify.js"></script>
<script src="https://colorlib.com/polygon/vendors/pnotify/dist/pnotify.buttons.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.2/js/dataTables.select.min.js" ></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>
<!-- Importando o js do bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<%- include('../../home/footer'); %>
</body>
</html>
<script>
    $(document).ready(function() {
        $('#mytable').DataTable( {
            dom: 'Bfrtip',
            order: ([ 6, 'desc']),
            "scrollX": true,
            pageLength: 50,
            buttons: [       
                {
                    "extend": "copyHtml5",
                    "text": "COPIAR",
                    header: false
                },          
                {
                    "extend": "pdf",
                    "text": "PDF",
                    header: false
                },
                {
                    "extend": "excelHtml5",
                    "text": "EXCEL",
                    header: false
                },
                {
                    "extend": "print",
                    "text": "IMPRIMIR",
                    header: false
                }
            ],language: {
                buttons: {
                    copyTitle: 'Copiado para área de transferência',
                    copyKeys: 'Appuyez sur <i>ctrl</i> ou <i>\u2318</i> + <i>C</i> pour copier les données du tableau à votre presse-papiers. <br><br>Pour annuler, cliquez sur ce message ou appuyez sur Echap.',
                    copySuccess: {
                        _: '%d linhas copiadas',
                        1: '1 linha copiada'
                    }
                },
                "paginate": {
                    "previous": "Anterior",
                    "next": "Próximo"
                },
                "search": "Pesquisar:"
            },
            select: true
        } );
    } );
    
    function setaDadosModal(valor) {
        document.getElementById('campo').value = valor;
    }
    
    function setaDadosModal2(valor) {
        document.getElementById('campo2').value = valor;
    }
    
    $("#negativoselect").on('change', function(e){
        var negativo = $(this).val();
        document.getElementById('negativo').value = negativo;
    });
    function novaHora(){
	var date = new Date();
		var data = date.getDate() + "/" + (date.getMonth()+1) + "/" + date.getFullYear();
		document.getElementById('data').value = data;
	
}
novaHora();

setInterval(function(){
        init_PNotify()
    },10000)
    
    function init_PNotify() {
        
        var data = new Date;
        var now = (new Date).toLocaleString().substr(11, 5)
        var hoje = data.getDate() + "/" + (data.getMonth()+1) + "/" + data.getFullYear();
        $('#mytable tbody tr').each(function(i){
            tr=$(this);
            tr.children('td').removeClass('fundoIdade');
            date = tr.children('td:eq(15)').html(); 
            console.log(hoje, date);
            if(hoje > date){
                $("mytable tr:eq(6)").addClass("fundoIdade1");
                notificação(); 

            }
            
        })         
    };
    
    function notificação(){
        new PNotify({
            title: "Alerta",
            type: "info",
            text: "Há paciente sem atualizar",
            maxonscreen: Infinity,
            closer: true,
            closer_hover: true,
            opacity: 0.95,
            history: false,
            sticker: true,
            nonblock: {
                nonblock: true,
            },
            addclass: 'pnotify-center',
            delay:2000,
            styling: 'bootstrap3',
            hide: true,
            remove: true
        });
    }
    


</script>